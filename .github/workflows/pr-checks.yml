name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  pull-requests: write # Allow workflow to post comments on PRs

jobs:
  # Run the actual checks
  pre-commit:
    uses: ./.github/workflows/reusable-pre-commit.yml

  terraform-lint:
    uses: ./.github/workflows/reusable-terraform-lint.yml

  # Comment on PR status after checks complete
  comment-status:
    needs: [pre-commit, terraform-lint]
    uses: ./.github/workflows/reusable-pr-status-commenter.yml
    with:
      required-checks: "pre-commit,terraform-lint,test-actions,test-workflows,python-ci"
      success-template: |
        🎉 **All checks passed!**

        ✅ **Pre-commit checks** - Code quality and formatting
        ✅ **Terraform lint** - Infrastructure code validation
        ✅ **Test Actions** - Custom actions validation
        ✅ **Test Workflows** - Reusable workflows validation
        ✅ **Python CI** - Unit and integration tests

        This PR is ready for review! 🚀

        📋 **Check Results:**
        - [View all checks](https://github.com/{{repo}}/pull/{{pr_number}}/checks)

        *Automated by PR Status Commenter*
      failure-template: |
        ❌ **Some checks failed**

        Please review and fix the issues below before requesting a review:

        {{checks}}

        📋 **Check Results:**
        - [View all checks](https://github.com/{{repo}}/pull/{{pr_number}}/checks)

        *Automated by PR Status Commenter*
      bot-name: "PR Check Bot"
